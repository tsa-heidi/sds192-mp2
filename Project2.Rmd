---
title: "Project2"
author: Heidi, Harriet, Viola 
output: 
  html_document:
    cold_folding: hide
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
devtools::install_github("benmarwick/wordcountaddin", type = "source", dependencies = TRUE)
```


```{r}
load("house_elections.rda")
load("candidates.rda")
load("committees.rda")
load("contributions.rda")
```


```{r}
library(tidyverse)
library(dplyr)
library(ggrepel)
```


Verifying the data
```{r}
glimpse(house_elections)
glimpse(candidates)
glimpse(committees)
glimpse(contributions)
```

Modifying Candidates
```{r}
candidates_NY2012 <- candidates %>%
  filter(cand_office_state == "NY")%>%
  filter(cand_party_affiliation == "DEM") %>%
  filter(cand_election_yr == 2012) %>%
  select(cand_id, cand_name)
candidates_NY2012
```

Create a table of candidate IDs
```{r}
cand_IDs <- select(candidates_NY2012, matches("cand_id"))
```

Modifying Contributions
```{r}
contributions_NY <- contributions %>% 
  filter(cand_id %in%
           cand_IDs$cand_id) %>%
  select(cand_id, transaction_amt)
```


Modifying house_elections
```{r}
house_elections_NY2012 <- house_elections %>%
  select(fec_id, ge_winner, incumbent)

```

joining contributions and candidates
```{r}
contr_cand_joined <- full_join(contributions_NY, candidates_NY2012, by= "cand_id") %>%
  group_by(cand_id, cand_name) %>%
  summarise(sum = sum(transaction_amt)) %>%
  arrange(sum)
contr_cand_joined
```


filter and modify house elections
```{r}
house_elections_NY2012 <- filter(house_elections_NY2012, fec_id %in% contr_cand_joined$cand_id)
house_elections_NY2012 <-  mutate(house_elections_NY2012, cand_id = fec_id )
```

Creating the final data frame
```{r}
final_df <- inner_join(contr_cand_joined, house_elections_NY2012, by = "cand_id") %>% 
  select(cand_name, sum, ge_winner, incumbent)

final_df <- select(final_df,cand_name, sum, ge_winner, incumbent) %>%
  arrange(final_df) %>%
  filter(sum>=40000)
final_df <- na.omit(final_df)
```

Creating a data graphic
```{r}

my_plot <- ggplot(data= final_df, aes(x = reorder(cand_name,-sum), y = sum, fill = ge_winner)) + 
  geom_bar(position = "dodge",stat = "identity")+
  coord_flip() +
  ggtitle("Amount of money spent on individual candidates")+
  xlab("")+
  labs(fill="")+
  scale_fill_discrete(labels=c("Lost","Won"))+
  scale_y_continuous(name="Money Spent (millions of USD)",breaks=c(0,2000000,4000000),labels=c("0$", "2,000,000$", "4,000,000$"))+
  facet_wrap(~incumbent)
  
my_plot + theme(axis.text.x = element_text(angle = 0)) 
options(scipen = 100000)



```


# Functions

Creating a function to wrangle candidates data
```{r}
function1_candidates <- function(year, state, party) {
  candidates %>%
    filter(cand_election_yr == year) %>%
    filter(cand_office_state == state) %>%
    filter(cand_party_affiliation == party) %>%
    select(cand_id, cand_name) 
}
```

```{r}
NY <- function1_candidates(2012, "NY", "DEM")
```

Takes your chosen state (e.g NY) and creates a list of candidate ids
```{r}
function2_candid_id <- function(function1df) {
  select(function1df, matches("cand_id"))
}
```

```{r}
NYid <- function2_candid_id(NY)
```

In this function, use your cadidate ID list retrieve contributions by candidate ID
```{r}
function3_contributions <- function(function2df) {
  contributions %>%
    filter(cand_id %in%
             function2df$cand_id) %>%
    select(cand_id, transaction_amt)
}
```

```{r}
NYcontributions <- function3_contributions(NYid)
```

In this function, join your candidate and their contributions by using your first data set when you modified candidates and your contributions data
```{r}
function4_joincand_cont <- function(function1df, function3df) {
  full_join(function1df, function3df, by="cand_id") %>%
    group_by(cand_id, cand_name) %>%
    summarise(sum=sum(transaction_amt)) %>%
    arrange(sum)
}
```

```{r}
JoinedNY <- function4_joincand_cont(NY, NYcontributions)
```

Function of house elections
```{r}
function5_house_elec <- function(function4df) {
  house_elections %>% 
    select(fec_id, ge_winner, incumbent) %>%
    filter(fec_id %in% function4df$cand_id) %>%
    mutate(cand_id = fec_id)
}

```

```{r}
Joinedhouse <- function5_house_elec(JoinedNY)
```

Create the final data frame
```{r}
function6_finaldf <- function(function4df, function5df) {
  inner_join(function4df, function5df, by = "cand_id") %>%
    select(cand_name, sum, ge_winner, incumbent) %>%
    arrange(ge_winner) %>%
    filter(!is.na(sum)) %>%
    filter(sum > 40000)
}
```

```{r}
finaldf <- function6_finaldf(JoinedNY, Joinedhouse)
```

NY Republicans
```{r}
NYR <- function1_candidates(2012, "NY", "REP")
NYRcandid <- function2_candid_id(NYR)
NYRcontr <- function3_contributions(NYRcandid)
NYRjoined <- function4_joincand_cont(NYR, NYRcontr)
NYRhouse <- function5_house_elec(NYRjoined)
NYRfinal <- function6_finaldf(NYRjoined, NYRhouse)
```

```{r}
my_plotNYR <- ggplot(data= NYRfinal, aes(x = cand_name, y = sum, fill = ge_winner)) + facet_wrap(~incumbent) +
  geom_bar(position = "dodge",stat = "identity")+
  coord_flip() +
  ggtitle("Amount of money spent on individual candidates")+
  xlab("")+
  labs(fill="")+
  scale_fill_discrete(labels=c("Lost","Won"))+
  scale_y_continuous(name="Money Spent (millions of USD)",breaks=c(0,2000000,4000000),labels=c("0$", "2,000,000$", "4,000,000$"))

my_plotNYR + theme(axis.text.x = element_text(angle = 0)) 
options(scipen = 100000)
```
