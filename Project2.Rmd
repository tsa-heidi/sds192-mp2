---
title: "Project2"
author: Heidi, Harriet, Viola 
output: 
  html_document:
    cold_folding: hide
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
load("house_elections.rda")
load("candidates.rda")
load("committees.rda")
load("contributions.rda")
```


```{r}
library(tidyverse)
library(dplyr)
library(ggrepel)
```


Verifying the data
```{r}
glimpse(house_elections)
glimpse(candidates)
glimpse(committees)
glimpse(contributions)
```

Modifying Candidates
```{r}
candidates_NY2012 <- candidates %>%
  filter(cand_office_state == "NY")%>%
  filter(cand_party_affiliation == "DEM") %>%
  filter(cand_election_yr == 2012) %>%
  select(cand_id, cand_name)
candidates_NY2012
```

Create a table of candidate IDs
```{r}
cand_IDs <- select(candidates_NY2012, matches("cand_id"))
```

Modifying Contributions
```{r}
contributions_NY <- contributions %>% 
  filter(cand_id %in%
           cand_IDs$cand_id) %>%
  select(cand_id, transaction_amt)
```


Modifying house_elections
```{r}
house_elections_NY2012 <- house_elections %>%
  select(fec_id, ge_winner, incumbent)

```

joining contributions and candidates
```{r}
contr_cand_joined <- full_join(contributions_NY, candidates_NY2012, by= "cand_id") %>%
  group_by(cand_id, cand_name) %>%
  summarise(sum = sum(transaction_amt)) %>%
  arrange(sum)
contr_cand_joined
```


filter and modify house elections
```{r}
house_elections_NY2012 <- filter(house_elections_NY2012, fec_id %in% contr_cand_joined$cand_id)
house_elections_NY2012 <-  mutate(house_elections_NY2012, cand_id = fec_id )
```

Creating the final data frame
```{r}
final_df <- inner_join(contr_cand_joined, house_elections_NY2012, by = "cand_id") %>% 
  select(final_df,cand_name, sum, ge_winner, incumbent)

final_df <- inner_join(contr_cand_joined, house_elections_NY2012, by = "cand_id")
final_df <- select(final_df,cand_name, sum, ge_winner, incumbent) %>%
  arrange(ge_winner) %>%
  filter(sum>=40000)
final_df <- na.omit(final_df)
```

Creating a data graphic
```{r}

my_plot <- ggplot(data= final_df, aes(x = cand_name, y = sum, fill = ge_winner)) + facet_wrap(~incumbent) +
  geom_bar(position = "dodge",stat = "identity")+
  coord_flip() +
  ggtitle("Amount of money spent on individual candidates")+
  xlab("")+
  labs(fill="")+
  scale_fill_discrete(labels=c("Lost","Won"))+
  scale_y_continuous(name="Money Spent (millions of USD)",breaks=c(0,2000000,4000000),labels=c("0$", "2,000,000$", "4,000,000$"))
  
my_plot + theme(axis.text.x = element_text(angle = 0)) 
options(scipen = 100000)



```

```{r}
my_plot2 <- ggplot(data = final_df, aes(x=sum, y=general_votes, color=ge_winner)) + geom_point()
my_plot2
```

Creating a function to wrangle candidates data
```{r}


mod_candidates <- function(year, state, party) {
  candidates %>%
    filter(cand_election_yr == year) %>%
    filter(cand_office_state == state) %>%
    filter(cand_party_affiliation == party) %>%
    select(cand_id, cand_name) 
}
```

```{r}
NY <- mod_candidates(2012, "NY", "DEM")
```

Takes your chosen state and creates a list of candidate ids
```{r}
candid_id <- function(yourdata) {
  select(yourdata, matches("cand_id"))
}
```

In this function, use your cadidate ID list retrieve contributions by candidate ID
```{r}
contributionsf <- function(statecandidateIDs) {
  contributions %>%
    filter(cand_id %in%
             statecandidateIDs$cand_id) %>%
    select(cand_id, transaction_amt)
}
```

```{r}
NYid <- candid_id(NY)
```

```{r}
NYcontributions <- contributionsf(NYid)
```

In this function, join your candidate their contributions by using your first function to choose a state and its candidates, and your contributions data
```{r}
joincandandcont <- function(yourcandidates, yourcontributions) {
  full_join(yourcandidates, yourcontributions, by="cand_id") %>%
    group_by(cand_id, cand_name) %>%
    summarise(sum=sum(transaction_amt)) %>%
    arrange(sum)
}
```

```{r}
joincandandcont(NY, NYcontributions)
mod_candidates <- function(year_arg, state_arg, party_arg) {
  candidates %>%
    filter(cand_election_yr == year_arg) %>%
    filter(cand_office_state == state_arg) %>%
    filter(cand_party_affiliation == party_arg) %>%
    select(cand_id, cand_name) 
}
```

```{r}
NY <- mod_candidates(2012, "NY", "DEM")
NY

mod_candidates <- function(year_arg, state_arg, party_arg) {
  candidates %>%
    filter(cand_election_yr == year_arg) %>%
    filter(cand_office_state == state_arg) %>%
    filter(cand_party_affiliation == party_arg) %>%
    select(cand_id, cand_name) 
}
```

```{r}
NY <- mod_candidates(2012, "NY", "DEM")
NY
```
